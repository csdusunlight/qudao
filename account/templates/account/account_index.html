{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>用户中心</title>
<link href="{% static 'images/favicon.ico'%}" rel="shortcut icon"/>
<!--<link rel="stylesheet" type="text/css" href="{% static 'css/User.css' %}" />-->
<link rel="stylesheet" type="text/css" href="{% static 'css/wfl-common.css' %}?v-3" />
<link rel="stylesheet" type="text/css" href="{% static 'css/account-base.css' %}?v-3" />
<!--<link rel="stylesheet" type="text/css" href="{% static 'css/style-i.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />-->
<script type="text/javascript" src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
<style type="text/css">
	/*个人中心*/
	body {
	  /*background-color: #fff;*/
	}
  .notice-index {
      padding-top: 10px;
      background-color: #fff;
      vertical-align: middle;
      
  }
  .notice__title {    
      margin: 0 20px 0 30px;
      width: 20px;
      display: inline-block;
      font-size: 16px;
      color: #91C11D;
      vertical-align: middle;
  }
  .notice__box {
      display: inline-block;
      padding: 10px 0 10px 10px;
      width: 915px;
      /*height: 102px;*/
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3) inset;
      /*overflow: hidden;*/
      vertical-align: middle;
  }
  .notice__txt {
      display: block;
      /*height: 34px;*/
      line-height: 34px;
      overflow: hidden;
      text-indent: 15px;
  }
  .choose_item-icon {
      display: inline-block;
      margin: 10px 10px 10px 38px;
      width: 26px;
      height: 26px;
      border-radius: 4px;
      border: 1px solid #e4e4e4;
      vertical-align: middle;
      cursor: pointer;
  }
  .need-icon.m-left {
      margin-left: 0;
  }
  .choose_item {
      opacity: 0;
      position: absolute;
  }
  .choose_item:checked + .choose_item-icon {
      background: url(../images/bg-checked.png) center center no-repeat;
  }
  
  .copy-link {
    position: relative;
      padding: 36px 0 26px;
  }
  .link-box {
      display: inline-block;
      margin-left: 110px;
      font-size: 16px;
  }
  .target-link {
      text-decoration: underline;
  }
  .btn.m-link {
      position: absolute;
      top: 30px;
      right: 130px;
  }
  .benefit {
      /*margin-top: 20px;*/
      padding: 20px;
      /*border: 1px solid #c9c9c9;*/
      background-color: #fff;
  }
  .benefit__item {
      display: inline-block;
      width: 320px;
      line-height: 36px;
      text-align: center;
  }
  .benefit__item-txt {
      font-size: 18px;
      color: #f95353;
  }
  .benefit__withdraw {
      display: inline-block;
      margin-left: 100px;
      margin-top: 18px;
      vertical-align: top;
  }
  .chart-box {
    margin-top: 20px;
    /*border: 1px solid #c9c9c9;*/
      background-color: #fff;
  }
  .chart {
      margin-top: 60px;
      margin-left: 200px;
  }
  .recommend {
      padding: 0 29px 0;
      margin-top: 20px;
      background-color: #fff;
      /*border: 1px solid #c9c9c9;*/
  }
  .recommend__titlebox {
      line-height: 68px;
  }
  .recommend__title {
      color: #91C11D;
  }
  .recommend__itembox {
      font-size: 0;
  }
  .recommend__item {
      display: inline-block;
      width: 228px;
      margin-right: 20px;
  }
  .recommend__item:hover .recommend__name {
      color: #91C11D;
  }
  .recommend__item:last-child {
      margin-right: 0;
  }
  .recommend__img {
      display: block;
      margin: 10px auto 0;
      width: 120px;
      height: 50px;
  }
  .recommend__img:hover {
      box-shadow: 0 0 10px 0 rgba(0,0,0,0.2);
  }
  .recommend__name {
      margin: 20px 0 10px 0;
  }
  .btn-box.m-account {
      margin: 20px 0;
      text-align: center;
  }
  .w-remark {
      width: 160px;
  }
  .w-zfb {
      width: 160px;
  }
  /*个人中心---end*/
/*引导遮罩*/
  body {
    width: 100%;
  }
 .guide-mask-box {
   display: none;
   position: fixed;
   top: 0;
   bottom: 0;
   left: 0;
   right: 0;
   background-color: rgba(0,0,0,0.7);
   z-index: 10000;
 }
 .guide-mask {
   position: relative;
   width: 1250px;
   margin: 0 auto;
 }
 .channel-guide {
   display: none;
   position: absolute;
   right: -40px;
 }
 .merchant-guide {
   position: absolute;
   right: 76px;
 }
 .mask-guide-location {
   display: block;
   width: 80px;
   height: 30px;
   line-height: 30px;
   background-color: #fff;
   border-radius: 4px;
   color: #222;
   text-align: center;
 }
 .mask-guide-img {
   display: block;
   margin: 20px 0 20px -16px;
 }
 .mask-guide-txt {
   margin-left: -180px;
   font-size: 18px;
   color: #fff;
 }
 .mask-guide-btn {
   display: block;
   width: 150px;
   height: 50px;
   margin-top: 40px;
   margin-left: -80px;
   line-height: 50px;
   border: 2px solid #fff;
   color: #fff;
   border-radius: 8px;
   text-align: center;
 }
</style>
</head>

<body>
  <!--引导遮罩-->
  <div class="guide-mask-box">
    <div class="guide-mask">
      <div class="merchant-guide">
        <span class="mask-guide-location">易推宝</span>
        <img class="mask-guide-img" src="/static/images/bg-guide-arror.png"/>
        <p class="mask-guide-txt">【放单系统】升级了，更名【易推宝】！</p>
        <a id="merchantGuideBtn" class="mask-guide-btn">下一步</a>
      </div>
      <div class="channel-guide">
        <span class="mask-guide-location">推广中心</span>
        <img class="mask-guide-img" src="/static/images/bg-guide-arror.png"/>
        <p class="mask-guide-txt">在【推广中心】交单，查看数据和设置主页！</p>
        <a id="channelGuideBtn" class="mask-guide-btn">朕知道了</a>
      </div>
    </div>
  </div>
  <!--引导遮罩---end-->
    	<!--头部-->
{% include "header.html" %}
   	<!--内容-->
<div class="Content">
   	<!--<div class="w1100">-->
			{% include "account/left.html" %}
            <div class="RightCont">
                <div style="display: none;" class="notice-index">
                    <h3 class="notice__title">通知栏</h3>
                    <div id="noticeBox" class="notice__box">
                        <ul id="con1">
                        </ul>
                    </div>
                </div>
                
                <ul class="benefit">
                    <li class="benefit__item">累计收益（元）<br /><span class="benefit__item-txt">{{user.accu_income}}</span></li>
                    <li class="benefit__item">账户余额（元）<br /><span class="benefit__item-txt">{{user.balance}}</span></li>
                    <li class="benefit__withdraw"><a href="{% url 'account_withdraw' %}" class="btn m-red">提现</a></li>
                    <div class="copy-link">
                        <p class="link-box">我的主页：<a href="http://{{user.domain_name}}.51fanshu.com" target="_blank" class="target-link">http://{{user.domain_name}}.51fanshu.com</a></p>
                        <a id="copy" class="btn m-red m-link">一键分享</a><!--<a style="margin-left: 244px;" href="{% url 'account_setting' %}" class="btn m-green m-link">设置</a>-->
                    </div>
                </ul>
                <div class="chart-box">
                  <div class="recommend__titlebox">
                    <h2 style="padding-left: 30px; color: #222;" class="recommend__title">结算金额统计</h2>
                  </div>
                  <div id="main" class="chart" style="width: 600px;height:400px;"></div>
                </div>
                <div class="recommend">
                    <div class="recommend__titlebox clearfix">
                        <h2 style="color: #222;" class="recommend__title l">热门推荐</h2>
                        <a class="recommend__more r" href="{% url 'project_all' %}" target="_blank">查看更多>></a>
                    </div>
                    <ul class="recommend__itembox">
                    {% for recom in recom_projects %}
                            <li class="recommend__item"><a href="{{recom.strategy}}" target="_blank">
                                <img class="recommend__img" src="{{recom.picture_url}}" alt="" />
                                <!--<h4 class="recommend__name oneline">{{recom.title}}</h4>
                                <p class="recommend__detail oneline">{{recom.introduction}}</p>
                                <div class="btn-box m-account">
                                    <a href="{{recom.strategy}}" target="_blank" class="btn m-green">查看攻略</a>
                                </div>-->
                            </a></li>
                    {%endfor%}
                    </ul>
                </div>
                
                
            </div>
            <div class="popup m-notice-top">
                <div class="popup__content" style="width: 600px;">
                    <div class="popup__top">
                        <h2 class="popup__title">置顶通知</h2><button type="button" class="popup__close popup__close-btn" onclick="canclePopup(this)">×</button>
                    </div>
                    <div class="popup__detail m-notice">
                    </div>
                    <div class="popup__btnbox">
                        <a class="cancel btn m-green" onclick="canclePopup(this)">我知道了</a>
                    </div>
                </div>
            </div>
</div>
{% include "footer.html" %}

<script type="text/javascript" src="{% static 'js/wfl-common.js' %}"></script>
<script type="text/javascript" src="{%static 'js/echarts.common.min.js'%}"></script>
<!--<script type="text/javascript" src="{% static "js/ZeroClipboard.js" %}"></script>-->
<script type="text/javascript" src="{% static 'js/clipboard.min.js' %}"></script>
<script type="text/javascript">
$(function(){
    $('.nav__item:eq(4)').addClass('active');
    $('.back-a1').toggleClass("on");
    var notice_flag = 0;
    var notice_top = '';
    var date = new Date();
    var now_time = date.getTime();
    function saveCookie() {
        var date = new Date();
        //  date.setDate(date.getDate()+1);
        date.setTime(date.getTime() + 1 * (24 * 60 * 60 * 1000));
        //将cookie保存1天
        setCookie("first_time", now_time, date.toUTCString(), "", "", "");
    }

    function setCookie(name, value, expires, path, domain, secure) {
        document.cookie = name + "=" + encodeURI(value) +
            ((expires) ? "; expires=" + expires : "") +
            ((path) ? "; path=" + path : "") +
            ((domain) ? "; domain=" + domain : "") +
            ((secure) ? "; secure=" + secure : "");
    }

    function getCookie(cName) {
        var cookieString = decodeURI(document.cookie);
        var cookieArray = cookieString.split("; ");
        console.log(cookieArray.length);
        for(var i = 0; i < cookieArray.length; i++) {
            var cookieNum = cookieArray[i].split("=");
            console.log(cookieNum.toString());
            var cookieName = cookieNum[0];
            var cookieValue = cookieNum[1];

            if(cookieName == cName) {
                return cookieValue;
            }
        }
        return false;
    }
    //删除Cookie就是简单的将cookie的expires属性设置为一个过去的时间即可。
    function deleteCookie() {
        var date = new Date();
        date.setTime(date.getTime() - 1000);
        setCookie("first_time", date.getTime(), date.toUTCString(), "", "", "");
    }
    
//  引导部分
    $('#merchantGuideBtn').click(function() {
      $('.merchant-guide').hide();
      $('.channel-guide').show();
    })
    $('#channelGuideBtn').click(function() {
      $('.guide-mask-box').hide();
      $('body').css('position','static');
      var date_guide = new Date();
      date_guide.setTime(date_guide.getTime() + 360 * (24 * 60 * 60 * 1000));
      setCookie("guide_flag", 'yes', date_guide.toUTCString(), "", "", "");
    })
    if(getCookie('guide_flag') === 'yes') {
      console.log('guide not first')
    } else {
      console.log('guide is fist')
      $('.guide-mask-box').show();
      $('body').css('position','fixed');
    }
//  引导部分----end
    var con1 = document.getElementById('con1');
    var notice_txt = '';
    $.ajax({
        url: '/restapi/announcement/?ordering=state',
        dataType: "json",
        type: 'get',
        success: function(ret) {
            if (ret.results.length != 0){
                var notice_num = 1;
                var notice_popup_num = 1;
//                  deleteCookie();
                
                var first_time = getCookie('first_time');
                
                console.log(first_time);
                console.log(now_time);
                date.setTime(first_time);
                var date_cookie = date.getFullYear() + '-' + date.getMonth() + '-' + date.getDate();
                date.setTime(now_time);
                var date_now = date.getFullYear() + '-' + date.getMonth() + '-' + date.getDate();
                console.log(date_cookie);
                console.log(date_now);
                if (first_time && date_now == date_cookie) {
                    console.log('已有');
                    notice_flag = 0;
                } else{
                    console.log('还未');
                    saveCookie();
                    notice_flag = 1;
                }
                
                for (var i in ret.results) {
                    notice_txt += '<li class="notice__item">';
                    if (ret.results[i].state == 0) {
                        notice_txt += '<span style="color:#f95a5a">【置顶】</span>';
                        notice_top += '<p><span>'+ (notice_popup_num++) +'、</span>' + ret.results[i].content +'</p>';
                    } else{
                        notice_txt += '<span>'+ (notice_num++) +'</span>、';
                    }
                    notice_txt += ret.results[i].content +'</li>';
                }
                if (notice_flag == 1 && notice_top != '') {
                    $('.popup__detail.m-notice').html(notice_top);
                    $('.popup.m-notice-top').addClass('in');
                }
            }
            con1.innerHTML = notice_txt;
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log(jqXHR.responseText);
            alert("数据错误");
        }
    });
    
    var clipboard = new Clipboard('#copy', {
        target: function() {
            return document.querySelector('.target-link');
        }
    });

    clipboard.on('success', function(e) {
        console.log(e);
    });

    clipboard.on('error', function(e) {
        console.log(e);
    });

//  图表部分
//  获取图表数据
    var chartdata_01;
    var data_x = [0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var data_y = [0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    $.ajax({
        url:"/restapi/userstatis/?page=1&pageSize=14&user={{user.id}}",
    	type:"get",
    	dataType: "json",
    	success: function(ret) {
    	    chartdata_01 = ret.results;
    	    console.log(ret.results.length);
    	    if (ret.results.length > 0) {
    	        for (var i = 0; i<ret.results.length; i++) {
    	        	data_x[i] = ret.results[i].date.slice(5);
    	        	data_y[i] = ret.results[i].settle_amount;
    	        	console.log('ret.results[i].date')
    	        }
    	    }
    	    console.log(data_x);
    	    console.log(data_y);
    	    //  获取图表数据---end
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById('main'));
            // 指定图表的配置项和数据
            var option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    crossStyle: {
                        color: '#999'
                    }
                }
            },
            toolbox: {
                feature: {
                    dataView: {show: true, readOnly: false},
                    magicType: {show: true, type: ['line', 'bar']},
                    restore: {show: true},
                    saveAsImage: {show: true}
                }
            },
            legend: {
                data:['结算数']
            },
            xAxis: [
                {
                    type: 'category',
                    data: data_x,
                    axisPointer: {
                        type: 'shadow'
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '结算金额',
                    axisLabel: {
                        formatter: '{value} 元'
                    }
                }

            ],
            color:['#61a0a8', '#2f4554', '#d48265', '#91c7ae','#749f83',  '#ca8622', '#bda29a','#6e7074', '#546570', '#c4ccd3'],
            series: [
                {
                    name:'结算金额',
                    type:'bar',
                    bgcolor: '#ffbe00',
                    data: data_y
                }

            ]
        };
        
            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        //  图表部分---end
        },
        error: function() {
            alert("请检查网络连接");
        }
    });


});

</script>
</body>
</html>
