{% load staticfiles %}
<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>官方项目详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="{% static 'css/mui.min.css' %}" rel="stylesheet" />
		<script type="text/javascript" src="{% static 'js/rem.js' %}"></script>
		<style type="text/css">
			body {
				background: white;
			}
			
			table {
				color: RGB(102, 102, 102);
				font-size: 14px;
			}
			
			td {
				padding: 1rem 1.3rem;
			}
			
			.txt {
				border: 1px solid RGB(153, 153, 153);
				border-radius: 6px;
				width: 18rem;
				height: 3rem;
				line-height: 3rem;
				position: relative;
			}
			
			.btn {
				width: 16rem;
				height: 4rem;
				background: RGB(145, 193, 29);
				text-align: center;
				line-height: 4rem;
				color: white;
				border-radius: 10px;
				margin-left: 6rem;
			}
			
			.decrBox {
				width: 100%;
				height: 3rem;
				position: relative;
			}
			
			.decrBox li {
				list-style: none;
				float: left;
				width: 4rem;
				height: 3rem;
				text-align: center;
				line-height: 3rem;
				margin-left: 1rem;
				border-radius: 6px;
			}
			
			.decrBox li:nth-child(1) {
				position: absolute;
				left: -1.5rem;
			}
			
			.decrBox li:nth-child(1),
			.decrBox li:nth-child(2) {
				background: RGB(254, 191, 0);
				color: white;
			}
			
			.decrBox li:nth-child(3),
			.decrBox li:nth-child(4) {
				border: 1px solid RGB(254, 191, 0);
				color: RGB(254, 191, 0);
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<h1 class="mui-title" style="color: RGB(102,102,102);">查看详情</h1>
		</header>
		<div class="mui-content" style="background: white;">
			<form>
				<table>
					<tr>
						<td><span>项目名称</span></td>
						<td>
						    <div class="txt">
                                <input id="title" type="text" />
                            </div>
						</td>
					</tr>
					<tr>
						<td><span>客户指导价</span></td>
						<td>
							<div class="txt">
								<input id="cprice" type="text" />
							</div>
						</td>
					</tr>
					<tr>
						<td><span>主页价格</span></td>
						<td>
							<div class="txt">
								<input id="shortprice" type="text" />
							</div>
						</td>
					</tr>
					<tr>
						<td><span>标期</span></td>
						<td>
							<div class="txt">
								<input id="term" type="text" />
							</div>
						</td>
					</tr>
					<tr>
						<td><span>投资区间</span></td>
						<td>
							<div class="txt">
								<input id="investrange" type="text" />
							</div>
						</td>
					</tr>
					<tr>
						<td><span>预计年化</span></td>
						<td>
							<div class="txt">
								<input id="intrest" type="text" />
							</div>
						</td>
					</tr>
					<!--<tr>
						<td><span>是否主业呈现</span></td>
						<td>
							<div class="mui-switch mui-switch-mini mui-active">
								<div class="mui-switch-handle"></div>
							</div>
						</td>
					</tr>
					<tr>
						<td><span>是否推荐</span></td>
						<td>
							<div class="mui-switch mui-switch-mini mui-active">
								<div class="mui-switch-handle"></div>
							</div>
						</td>
					</tr>-->
					<tr>
						<td><span>项目标签</span></td>
						<td>
							<ul class="decrBox mark-box">
								{% for item in checkedmarks %}
                                    <li data-id="{{item.id}}" class="mark">{{item.name}}</li>
                                {%endfor%}
							</ul>
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<a>
								<div id="submit" class="btn submit">确定</div>
							</a>
						</td>
					</tr>
				</table>
			</form>
		</div>

		<script src="{% static 'js/mui.min.js' %}"></script>
		<script type="text/javascript">
			mui.init();
			var project_id = "{{id}}";
            var company_id;
            var strategy;
            var title = document.getElementById('title'),
                cprice = document.getElementById('cprice'),
                shortprice = document.getElementById('shortprice'),
                term = document.getElementById('term'),
                investrange = document.getElementById('investrange'),
                intrest = document.getElementById('intrest');
                
            mui.ajax('/restapi/projects/' + project_id + '/',{
                dataType:'json',//服务器返回json格式数据
                type:'get',//HTTP请求类型
                timeout:10000,//超时时间设置为10秒；
                success:function(ret){
                    company_id = ret.company;
                    strategy = ret.strategy;
                    title.value = ret.title;
                    cprice.value = ret.cprice?ret.cprice:ret.cprice;
                    shortprice.value = ret.shortprice;
                    term.value = ret.term;
                    investrange.value = ret.investrange;
                    intrest.value = ret.intrest;
                },
                error:function(xhr,type,errorThrown){
                    console.log(xhr.responseText);
                }
            });
            
            var checked_marks = {{checked_marks}};
            console.log('marks: '+checked_marks);
            mui('.mark-box .mark').each(function(){
                var i;
                var mark_id = this.getAttribute('data-id');
                console.log(mark_id);
                for (i in checked_marks) {
                    if (mark_id == checked_marks[i]) {
                        this.className = 'mark on';
                        console.log('on');
                    }
                }
            })
            mui('.mark-box').on('tap', '.mark', function(){        //选择标签
                if (this.className == 'mark on') {
                    this.className = 'mark';
                } else{
                    
                    if (mui('.mark.on').length >= 3) {
                        mui.alert('每个项目最多选择三个标签');
                    } else {
                        this.className = 'mark on';
                    }
                }
            })
            
            document.getElementById('submit').addEventListener('tap',function (){
                var mark_str = '';
                mui('.mark.on').each(function(){
                    mark_str += this.getAttribute('data-id') + ',';
                })
                
                if (!title || !cprice || !shortprice || !term || !investrange || !intrest) {
                    mui.alert('填写项不能为空');
                }
                mui.ajax('/account/create_update_selfproject/' + project_id + '/',{
                    data: {
                        'company': company_id,
                        'strategy': strategy,
                        'title': title.value,
                        'cprice': cprice.value,
                        'shortprice': shortprice.value,
                        'term': term.value,
                        'investrange': investrange.value,
                        'intrest': intrest.value,
                        'marks': mark_str,
                    },
                    dataType:'json',//服务器返回json格式数据
                    type:'post',//HTTP请求类型
                    timeout:10000,//超时时间设置为10秒；
                    success:function(ret){
                        if (ret.code == 0) {
                            mui.alert('修改成功');
                        } else{
                            console.log(ret.msg);
                        }
                    },
                    error:function(xhr,type,errorThrown){
                        console.log(xhr.responseText);
                    }
                });
            })
		</script>
	</body>

</html>