{% load staticfiles %} {% load myfilter %}
<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <!-- 优先使用 IE 最新版本和 Chrome -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <!-- 为移动设备添加 viewport -->
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <!-- 添加到主屏后的标题（iOS 6 新增） -->
    <meta name="apple-mobile-web-app-title" content="">
    <!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- 设置苹果工具栏颜色 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <!-- 添加智能 App 广告条 Smart App Banner（iOS 6+ Safari） -->
    <meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL">
    <!-- 忽略页面中的数字识别为电话，忽略email识别 -->
    <meta name="format-detection" content="telphone=no" />
    <!--下面三个是清除缓存 微信浏览器缓存严重又无刷新；这个方法调试的时候很方便-->
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title></title>
    <link href="{% static 'css/mui.min.css' %}" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/m_common.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/m_account_withdraw.css' %}" />
    <script>
        (function (designWidth, maxWidth) {
            var doc = document,
                win = window,
                docEl = doc.documentElement,
                remStyle = document.createElement("style"),
                tid;

            function refreshRem() {
                var width = docEl.getBoundingClientRect().width;
                maxWidth = maxWidth || 540;
                width > maxWidth && (width = maxWidth);
                var rem = width * 100 / designWidth;
                remStyle.innerHTML = 'html{font-size:' + rem + 'px;}';
            }

            if (docEl.firstElementChild) {
                docEl.firstElementChild.appendChild(remStyle);
            } else {
                var wrap = doc.createElement("div");
                wrap.appendChild(remStyle);
                doc.write(wrap.innerHTML);
                wrap = null;
            }
            //要等 wiewport 设置好后才能执行 refreshRem，不然 refreshRem 会执行2次；
            refreshRem();

            win.addEventListener("resize", function () {
                clearTimeout(tid); //防止执行两次
                tid = setTimeout(refreshRem, 300);
            }, false);

            win.addEventListener("pageshow", function (e) {
                if (e.persisted) { // 浏览器后退的时候重新计算
                    clearTimeout(tid);
                    tid = setTimeout(refreshRem, 300);
                }
            }, false);

            if (doc.readyState === "complete") {
                doc.body.style.fontSize = "16px";
            } else {
                doc.addEventListener("DOMContentLoaded", function (e) {
                    doc.body.style.fontSize = "16px";
                }, false);
            }
        })(750, 750);
    </script>
</head>

<body>
    <header id="header" class="mui-bar mui-bar-nav">
        <a href="{% url 'account_index' %}" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
        <h1 class="mui-title">提现</h1>
    </header>
    <div class="mui-content">
        <!-- 未绑定银行卡盒子 -->
        
        <div class="no_bindBankCardBox">
            <div class="no_bindImgBox">
                <img src="/static/images/no_bindCard.png" />
            </div>
            <div class="bankBox">
                <div class="bank_name">
                    <p class="addCard">点击添加银行卡</p>
                </div>
            </div>
            <div class="operateBox">
                <p class="operate">></p>
            </div>
        </div>
        
        <!-- 已绑定银行卡盒子 -->
        
        <div class="bindBankCardBox" id="changeCard">
            <div class="imgBox">
                    <!-- {%if card.bank %} -->
                    <img src="/static/images/{{card.bank}}.png" />
                    <!-- {%endif%} -->
            </div>
            <div class="bankBox">
                <div class="bank_name">
                    <p><span>{{card.get_bank_display}}</span></p>
                </div>
                <div class="bank_num">
                    <p><span><a>{{card.card_number}}</a></span></p>
                </div>
            </div>
            <div class="operateBox">
                <a href="changeCard" class="mui-btn mui-btn-primary mui-btn-block mui-btn-outlined">修改></a>
            </div>
        </div>
       
        <!-- 未绑定支付宝盒子 -->
       
        <div class="no_bindAlipayBox">
            <div class="no_bindImgBox">
                <img src="/static/images/no_bindZfb.png" />
            </div>
            <div class="bankBox">
                <div class="bank_name">
                    <p class="addCard">点击添加银行卡</p>
                </div>
            </div>
            <div class="operateBox">
                <p class="operate">></p>
            </div>
        </div>
        <!-- 已绑定支付宝盒子 -->
        
        <div class="bindAlipayBox">
            <div class="imgBox1">
                <img src="/static/images/zfbLogo.png" />
            </div>
            <div class="bankBox">
                <div class="bank_name">
                    <p><span>支付宝（{{user.zhifubao_real_name}}）</span></p>
                </div>
                <div class="bank_num">
                    <p><span><a>{{user.zhifubao}}</a></span></p>
                </div>
            </div>
            <div class="operateBox">
                <p>修改></p>
            </div>
        </div>
        
        <!-- 可提现金额 -->
        <p style="margin: 0 0.5rem 0.2rem">可提现金额<span style="color: RGB(149,194,38);">{{user.balance}}</span>元</p>
        <div class="amountBox">
            <p style="margin-left: 0.3rem;">提现金额</p>
            <input id="amontIpt" type="text" placeholder="输入的提现金额大于10元" />
            <p>元</p>
        </div>
        <button class="submit">确定</button>
        <!-- 弹出层 -->
        <div id="picture" class="mui-popover mui-popover-action mui-popover-bottom">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell">
                    <a href="#">拍照或录像</a>
                </li>
                <li class="mui-table-view-cell">
                    <a href="#">选取现有的</a>
                </li>
            </ul>
            <ul class="mui-table-view">
                <li class="mui-table-view-cell">
                    <a href="#picture"><b>取消</b></a>
                </li>
            </ul>
        </div>
        <!-- <div id="bank_card" class="zhanghu">
                <div class="msg clearfix">
          {%if card.bank %}
                       <img src="/static/images/{{card.bank}}.png" />
          {%endif%}
                    <div class="text">
                        {%if card %}
                            <p><span>{{card.get_bank_display}}</span><br />
                            <span><a>{{card.card_number}}</a></span></p>
                        {%else%}
                            <p><span>请点此绑定银行卡，并刷新该页面</span></p>
                        {%endif%}
                    </div>
                </div>

            </div>
            
            <form class="mui-input-group">
            {% csrf_token %}
                <div class="mui-input-row">
                    <label>￥</label>
                    <input id="with_amount" autofocus="autofocus" type="text" class="mui-input-clear" placeholder="请输入提现金额">
                </div>
            </form>
            <p>
                <span>可提现金额：<number>{{user.balance}}</number></span>
                <span>最低提现10元</span>
            </p>
            <button id="Btn" type="button" class="mui-btn mui-btn-green mui-btn-block">确认提现</button>

            <div id="sheet1" class="mui-popover mui-popover-bottom mui-popover-action ">
               
                <ul class="mui-table-view">
                  <li class="mui-table-view-cell">
                    {%if card %}
                                <a href="{% url 'change_bankcard' %}">更换银行卡</a>
                            {%else%}
                                <a href="{% url 'account_bankcard' %}">绑定银行卡</a>
                            {%endif%}
                  </li>
                </ul>
               
                <ul class="mui-table-view">
                  <li class="mui-table-view-cell">
                    <a href="#sheet1"><b>取消</b></a>
                  </li>
                </ul>
            </div> -->
    </div>
    {% include "m_footer.html" %}

    <script src="{% static 'js/mui.min.js' %}"></script>
    <!--弹窗部分-->
    <script type="text/javascript" charset="utf-8">
            mui.init({
                swipeBack: true //启用右滑关闭功能
            });
            var balance = {{user.balance}};
            //提现功能
            var withdraw_url = "{%url 'account_withdraw' %}";
            document.querySelector(".submit").addEventListener('tap',function(){
                var amount = document.getElementById("amontIpt").value;
                console.log(amount);
                amount = parseInt(amount);
                if (balance < amount) {
                    mui.alert("提现金额不能大于可以现金额")
                    return;
                }else if(isNaN(amount)){
                    mui.alert('提现数量必须为整数！');
                    return;
                }else if (isNaN(amount) || (amount<10)) {
                    mui.alert('提现金额应为大于等于为10的整数！');
                    return;
                }
                var confirm_str = "您提现的金额为人民币" + amount + "元，确认？"
                var btnArray = ['否', '是'];
                mui.confirm(confirm_str,'提现确认',btnArray,function (e) { 
                    if(e.index == 1){
                        mui.ajax({
                            url: withdraw_url,
                            dataType:"json",
                            type:'POST',
                            data : {
                                amount: amount,
                                
                            },
                            success:function(ret){
                                if (ret.code == 0) {
                                    mui.alert('申请提现成功');
                                } else {
                                    mui.alert(ret.res_msg);
                                }
                            },
                            error:function(){
                                alert("请检查网络连接");
                            }
                        });
                    }else{
                        console.log(222)
                    }
                 })
            });
            //更换银行卡
            document.getElementById("changeCard").addEventListener('tap',function () { 
                mui.alert("更换~")

             })






            // var withdraw_url = "{%url 'account_withdraw' %}";
            // document.getElementById("Btn").addEventListener('tap', function() {
            //     var amount = document.getElementById("with_amount").value;
            //     amount = parseInt(amount);
            //     if (isNaN(amount)){
            //         mui.alert('提现数量必须为整数！');
            //         return;
            //     }
            //     if (isNaN(amount) || (amount<10)) {
            //         mui.alert('提现金额应为大于等于为10的整数！');
            //         return;
            //     }
            //     var csrfmiddlewaretoken = document.getElementsByName("csrfmiddlewaretoken")[0].value;
            //     var btnArray = ['否', '是'];
            //     var confirm_str = "您提现的金额为人民币" + amount + "元，确认？"
            //     mui.confirm(confirm_str, '提现确认', btnArray, function(e) {
            //         if (e.index == 1) {
            //             mui.ajax({
            //                 url: withdraw_url,
            //                 dataType:"json",
            //                 type:'POST',
            //                 data : {
            //                     amount: amount,
            //                     csrfmiddlewaretoken:csrfmiddlewaretoken
            //                 },
            //                 success:function(ret){
            //                     if (ret.code == 0) {
            //                         mui.alert('申请提现成功');
            //                     } else {
            //                         mui.alert(ret.res_msg);
            //                     }
            //                 },
            //                 error:function(){
            //                     alert("请检查网络连接");
            //                 }
            //             });
            //         }
            //     })
            // });
            // document.getElementById("bank_card").addEventListener('tap', function() {
            //     mui('#sheet1').popover('toggle');
            // });
            // mui('.mui-bar').on('tap', '.mui-action-back', function() {
            //     var href = this.getAttribute("href");
            //     mui.openWindow({
            //         url: href,
            //         styles: {
            //             top: 0,
            //             bottom: 0
            //         },
            //         show: {
            //             aniShow: 'slide-in-right',
            //         },
            //         waiting: {
            //             autoShow: false, //自动显示等待框
            //             title: '正在加载...', //等待对话框上显示的提示内容
            //         }
            //     });
            // });
    </script>
</body>

</html>