{% load staticfiles %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>用户中心</title>
    <link href="{% static 'images/favicon.ico'%}" rel="shortcut icon" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/User.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/wfl-common.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/account-base.css' %}" />
    <!--<link rel="stylesheet" type="text/css" href="{% static 'css/style-i.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/dialog.css' %}" />
    <script type="text/javascript" src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/wfl-common.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/wfl-popup.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/accounts/refresh.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/wfl-popup.js' %}"></script>
    <style type="text/css">
        .isauto-box {
            padding-left: 20px;
            margin-top: 30px;
        }

        .topBox {
            padding: 48px 38px 10px;
            font-size: 15px;
            border-bottom: 10px solid #f5f5f5;
        }

        .topBox>span {
            display: inline-block;
            color: #4d4d4d;
        }

        /* 已绑定银行卡 */
        .bindCard img {
            display: inline-block;
            height: 30px;
            margin-top: -4px;
            vertical-align: middle;
        }

        .change {
            font-size: 14px;
            text-decoration: underline;
            color: #91c11d;
            cursor: pointer;
            margin-left: 30px;
        }

        /* 未绑定银行卡 */

        .no_bindCard>span:nth-child(2) {
            color: #91c11d;
            text-decoration: underline;
            margin-left: 36px;
            cursor: pointer;
        }

        /* 已绑定支付宝 */
        .bindAlipay {
            margin-top: 40px;
        }

        /* 未绑定支付宝 */

        .no_bindAlipay {
            margin-top: 40px;
        }

        .no_bindAlipay>span:nth-child(2) {
            color: #91c11d;
            text-decoration: underline;
            margin-left: 36px;
            cursor: pointer;
        }

        /* 提示部分 */

        .tips {
            margin-top: 40px;
        }

        .tips>span:nth-child(1) {
            width: 17px;
            height: 17px;
            border-radius: 50%;
            background: #ea5b59;
            color: #fff;
        }

        .tips>span:nth-child(2) {
            margin-left: 10px;
            color: #989898;
        }

        .tips>span:nth-child(3) {
            display: inline-block;
            margin: 10px 60px;
            color: #989898;
        }

        /* 银行卡绑定盒子 */

        .bindCardBox {
            width: 1030px;
            min-height: 700px;
            background: white;
        }

        /* 更换、绑定银行卡 */

        .bindCardBox {
            padding: 18px 24px;
            color: #666666;
            display: none;
        }

        .bindCardBox>span {
            font-size: 18px;
            cursor: pointer;
        }

        .bindCardBox>span:hover {
            color: #91c11d;
        }

        .bankCardInfoBox {
            margin: 30px 30px 30px 10px;
        }

        .bankCardInfoBox>p {
            color: #91c11d;
            font-size: 18px;
            font-weight: 600;
        }

        .info {
            margin-top: 30px
        }

        .itemTxt {
            font-size: 16px;
        }

        .itemIpt {
            width: 352px !important;
            height: 50px !important;
            border-radius: 10px;
            margin-left: 26px;
        }

        .selectBox {
            width: 352px !important;
            height: 50px !important;
            border-radius: 10px;
            margin-left: 26px;
        }

        .bindCardBtn {
            width: 100px;
            height: 45px;
            border-radius: 10px;
            background: #91c11d;
            border: none;
            color: white;
            margin: 30px 200px
        }

        /* 更换、绑定支付宝盒子 */

        .change_bindAlipayBox {
            padding: 18px 24px;
            color: #666666;
            background: white;
            min-height: 700px;
            display: none;
        }

        .AlipayInfoBox>p {
            color: #91c11d;
            font-size: 18px;
            font-weight: 600;
        }

        .zhifubao_back {
            font-size: 18px;
            cursor: pointer;
        }

        .zhifubao_back:hover {
            color: #91c11d;
        }

        .AlipayInfoBox {
            margin: 30px 30px 30px 10px;
        }

        .codeBox {
            position: relative;
            display: inline;
        }

        .codeIpt {
            width: 222px !important;
            height: 50px !important;
            border: 1px solid #e4e4e4;
            margin-left: 26px;
            border-radius: 10px 0 0 10px;
        }

        .code {
            display: inline-block;
            width: 130px;
            height: 50px;
            background: #e5e5e5;
            position: absolute;
            top: -17px;
            right: -130px;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            border: none;
            outline: none;
        }

        .change_bindAlipayBtn {
            width: 100px;
            height: 45px;
            border-radius: 10px;
            background: #91c11d;
            border: none;
            color: white;
            margin: 50px 260px;
        }
        /* 绑定支付宝盒子 */
        .bindAlipayBox{
            padding: 18px 24px;
            color: #666666;
            background: white;
            min-height: 700px;
            display: none;
        }
        .back1{
            font-size: 18px;
            cursor: pointer;
        }
        .back1:hover{
            color: #91c11d;
        }
        .bindAlipayBtn {
            width: 100px;
            height: 45px;
            border-radius: 10px;
            background: #91c11d;
            border: none;
            color: white;
            margin: 50px 200px;
        }
        .switch__name {
            display: inline-block;
            font-size: 16px;
            line-height: 30px;
            vertical-align: top;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            border-radius: 15px;
            background-color: #fff;
            border: 1px solid #e4e4e4;
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .switch:before {
            content: "";
            position: absolute;
            left: 0px;
            top: 0px;
            width: 30px;
            height: 30px;
            background-color: #fff;
            border-radius: 50%;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.5);
            transition: all 0.4s ease;
        }

        .switch.True {
            background-color: #91C11D;
            /*border: 1px solid #91C11D;*/
        }

        .switch.True:before {
            left: 32px;
        }
    </style>
    <script type="text/javascript">
        var coderefresh_url = "{% url 'captcha-refresh' %}";
        $.ajaxSetup({
            data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
        });

        function isadd(obj) {        //是否主页显示调用函数
            var flag = $(obj).data('isadd');
            console.log(flag)
            if (flag == 'True') {
                $.ajax({
                    url: '/restapi/users/' + {{ user.id }} + '/',
                        dataType: "json",
                            type: "put",
                                data: {
                'is_autowith': false
            },
            success: function(ret) {
                console.log('关闭');
                $(obj).data('isadd', 'False');
                $(obj).removeClass('True').addClass('False');
            },
            error: function() {
                alert("请检查网络连接");
            }
        });
        
    } else {
            $.ajax({
                url: '/restapi/users/' + {{ user.id }} + '/',
                    dataType: "json",
                        type: "put",
                            data: {
            'is_autowith': true
        },
        success: function(ret) {
            console.log('开启');
            $(obj).data('isadd', 'True');
            $(obj).removeClass('False').addClass('True');
        },
        error: function() {
            alert("请检查网络连接");
        }
        });
        
    }
}

        $(function () {
            $('.back-a9').toggleClass("on");
            $("#submit").click(function () {
                amount = $("#withdraw_amount").val();
                amount = parseFloat(amount, 0);
                if (isNaN(amount) || (amount < 10)) {
                    alert("提现金额最小为10元！");
                    return;
                }
                $("#rmb_with").text(amount)
                $('.popup.m-withdraw').addClass('in');
            });
            $('#edit_confirm').click(function () {
                $(".popup1").hide();
                amount = $("#withdraw_amount").val();
               
                var post_url = "{%url 'account_withdraw' %}";
                $.ajax({
                    url: post_url,
                    dataType: "json",
                    type: 'POST',
                    data: {
                        'amount': amount,
                    },
                    success: function (ret) {
                        if (ret.code == 0) {
                            $('.popup.m-withdraw').removeClass('in');
                            alert("提现申请提交成功！");
                            window.location.href = "{% url 'account_money' %}";
                        }
                    },
                    error: function () {
                        alert("请检查网络连接");
                    }
                });
            });
            $('.btn_x').click(function () {
                $(this).parent().parent().hide();
                bRotate = false;
            });
            $('.btn_cont button').click(function () {
                $(this).parent().parent().parent().parent().hide();
            });

            // 支付宝盒子绑定状态
            var zhifubao = $(".AlipayBox").attr("data-zhifubao");
            if(zhifubao === ''){
                $(".no_bindAlipay").css("display","block");
                $(".bindAlipay").css("display","none");
            }else if(zhifubao){
                $(".no_bindAlipay").css("display","none");
                $(".bindAlipay").css("display","block");
            }
            //银行卡盒子绑定状态
            var cardNumber = $(".cardBox").attr("data-card");
            if (cardNumber === '') {
                $(".no_bindCard").css("display","block");
                $(".bindCard").css("display","none");
            }else if(cardNumber){
                $(".no_bindCard").css("display","none");
                $(".bindCard").css("display","block");
            }
            //支付宝绑定
            $(".bind_zhifubao").click(function () { 
                $(".RightCont1").hide();
                $(".bindAlipayBox").show();
             });
            $(".back1").click(function () { 
                $(".RightCont1").show();
                $(".bindAlipayBox").hide();
             }); 

            //绑定支付宝Ajax
             $(".bindAlipayBtn").click(function () { 
                var bind_zhifubao = $(".zhifubao").val();
                var real_name = $(".bind_real_name").val();
                if (!bind_zhifubao || !real_name) {
                    $.prompt({
                        "Content":"输入框不能为空！"
                    });
                }
                //ajax
                $.ajax({
                    url: '/account/bind_zhifubao/',
                    type: "post", //提交方式post
                    async: true, //是否同步
                    timeout: 5000, //超出时间
                    dataType: 'json', //返回数据格式Json
                    data: {
                        "zhifubao": bind_zhifubao,
                        "zhifubao_real_name":real_name
                    },
                    success: function (ret) {
                        if (ret.count === 0) {
                            $.prompt({
                                "Content":"绑定成功"
                            });
                        }
                        bind_zhifubao = '';
                        real_name = '';
                    },
                    error: function (xhr, textStatus) {
                        console.log('错误:' + xhr.responseText);
                    }
                });
            })
            
        });
    </script>
</head>

<body>
    {% include "header.html" %}
    <div class="Content">
        <!--头部-->
        <!--内容-->
        {% include "account/left.html" %}
        <div class="RightCont">
            <div class="RightCont1">
                <div class="binding" style=" min-height:515px">
                    <div class="Binding-Top">
                        <!-- <h2>提现</h2> -->
                        <div class="topBox">
                            <!-- 已绑定银行卡 -->
                            <div class="cardBox" data-card="{{card.card_number}}">
                                <div class="bindCard">
                                    <span>银行卡绑定</span>
                                    <span style="margin-left: 62px">
                                        <img src="/static/images/{{card.bank}}.png" />
                                        <b style="font-size: 20px;color: #4d4d4d;">{{card.get_bank_display}}</b>
                                    </span>
                                    <span style="margin-left: 30px">{{card.card_number}}</span>
                                    <span style="margin-left: 30px">{{card.real_name}}</span>
                                    <span class="change change_bankCard">更换</span>
                                </div>
                                <!-- 未绑定银行卡 -->
                                <div class="no_bindCard">
                                    <span>银行卡绑定</span>
                                    <span>未绑定</span>
                                </div>
                            </div>
                            <!-- 已绑定支付宝 -->
                            <div class="AlipayBox" data-zhifubao="{{user.zhifubao}}">
                                <div class="bindAlipay">
                                    <span >支付宝绑定</span>
                                    <span style="margin-left: 62px">{{user.zhifubao}}</span>
                                    <span style="margin-left: 30px">{{user.zhifubao_real_name}}</span>
                                    <span class="change Alipay">更换</span>
                                </div>
                                <div class="no_bindAlipay">
                                    <span>支付宝绑定</span>
                                    <span class="bind_zhifubao">未绑定</span>
                                </div>
                            </div>
                            <div class="tips">
                                <span>！</span>
                                <span>注：单笔提现金额大于5万时，将提现至已绑定银行卡；单笔提现金额小于5万时，将提现至已绑定支付宝，当未绑定相应账号时，</span>
                                <span>将提现失败！</span>
                            </div>
                        </div>
                    </div>
                    <div class="Cash-box">
                        <div class="Cash-info">
                            <span>可提现金额：</span>
                            <i>{{user.balance}}</i>
                        </div>

                        <div class="Cash-input">
                            <span>提现金额：</span>
                            <input id="withdraw_amount" type="text" />
                            <i>（最低提现10元）</i>
                        </div>
                        <input id="submit" type="submit" value="确  定" />

                    </div>
                    <div class="isauto-box">
                        <span class="switch__name">开启自动提现&nbsp;&nbsp;</span>
                        <span data-isadd="{{user.is_autowith}}" class="home switch {{user.is_autowith}}" onclick="isadd(this)"></span>
                        <p>注：每个工作日的10:50和17:50，如果您的账户余额大于10元，系统将自动提现</p>
                    </div>
                </div>
            </div>
            <!-- 更换、绑定银行卡盒子 -->
            <div class="bindCardBox">
                <span><返回</span>
                    <div class="bankCardInfoBox">
                        <p>银行卡绑定</p>
                        <div class="info">
                            <span class="itemTxt">请选择银行</span>
                            <select class="selectBox">
                                <option value="0">----</option>
                            </select>
                        </div>
                        <div class="info">
                            <span class="itemTxt">请填写支行</span>
                            <input class="itemIpt branchBank" type="text" maxlength="15" />
                        </div>
                        <div class="info">
                            <span class="itemTxt">持卡人姓名</span>
                            <input class="itemIpt cardName" type="text" />
                        </div>
                        <div class="info">
                            <span class="itemTxt">请输入卡号</span>
                            <input class="itemIpt cardNum" type="text" />
                        </div>
                        <button class="bindCardBtn">确定</button>
                    </div>
            </div>
            <!-- 更换支付宝盒子 -->
            <div class="change_bindAlipayBox">
                <span class="zhifubao_back"><返回</span>
                <div class="AlipayInfoBox">
                    <p>更换支付宝</p>
                    <div class="info">
                        <span class="itemTxt">请填支付宝账号</span>
                        <input class="itemIpt alipayAccount" type="text">
                    </div>
                    <div class="info">
                        <span class="itemTxt" style="margin-left: 16px">请填真实姓名</span>
                        <input class="itemIpt realName" type="text">
                    </div>
                    <div class="info">
                        <span class="itemTxt" style="margin-left: 62px;">验证码</span>
                        <div class="codeBox">
                            <input class="codeIpt" type="itemTxt">
                            <button class="code" onClick="settime(this)">获取验证码</button>
                        </div>
                    </div>
                    <button class="change_bindAlipayBtn">确定</button>
                </div>
            </div>
            <!-- 绑定支付宝盒子 -->
            <div class="bindAlipayBox">
                <span class="back1"><返回</span>
                <div class="AlipayInfoBox">
                    <p>绑定支付宝</p>
                    <div class="info">
                        <span class="itemTxt">支付宝账号</span>
                        <input class="itemIpt zhifubao" type="text">
                    </div>
                    <div class="info">
                        <span class="itemTxt" style="margin-left: 16px">真实姓名</span>
                        <input class="itemIpt bind_real_name" type="text">
                    </div>
                    <button class="bindAlipayBtn">确定</button>
                </div>
            </div>
        </div>

        <!-- 提现弹窗部分 -->
        <div class="popup m-withdraw">
            <div class="popup__content" style="width: 600px;">
                <div class="popup__top">
                    <h2 class="popup__title">温馨提示</h2>
                    <button type="button" class="popup__close popup__close-btn" onclick="canclePopup(this)">×</button>
                </div>
                <div class="popup__detail">
                    <div class="popup__item">
                        <p>您好，您本次提现现金为
                            <font id="rmb_with"></font>元，预计将在24小时内到达您的银行卡内，如遇节假日时间将顺延。</p>
                    </div>
                </div>
                <div class="popup__btnbox">
                    <a id="edit_confirm" class="btn m-green m-popup popup-confirm popup__close-btn">确认</a>
                </div>
            </div>
        </div>
        <!--底部-->
        <div style="clear: both;"></div>
    </div>
    {% include "footer.html" %}
    <!--浮动窗口-->
    </div>

</body>

</html>