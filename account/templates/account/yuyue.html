{% load staticfiles %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>用户中心</title>
<link href="{% static 'images/favicon.ico'%}" rel="shortcut icon"/>
<link rel="stylesheet" type="text/css" href="{% static 'css/wfl-common.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/account-base.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/wfl-page.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/datePicker.css' %}" />
<script type="text/javascript" src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/wfl-common.js' %}"></script>
<script type="text/javascript" src="{% static 'js/page.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.date_input.pack.js' %}"></script>
<style type="text/css">
	.fubi-box {
	    margin-bottom: 20px;
	    height: 80px;
	    background-color: #fff;
	}
	.fubi-item {
	    display: inline-block;
	    margin-left: 20px;
	    min-width: 200px;
	    height: 80px;
	    line-height: 80px;
	    font-size: 18px;
	}
	.fubi-num {
	    display: inline-block;
	    padding: 0 10px;
	    color: #FFBE00;
	    font-size: 24px;
	}
	.tixian {
	    margin-top: 22px;
	    margin-right: 20px;
	}
</style>
<script type="text/javascript">
var data = '<table width="100%"><thead><tr><th height="44">预约项目</th>' +
'<th>手机号</th><th>QQ</th><th>预约金额</th><th>备注</th><th>状态</th><th>操作</th></tr></thead><tbody>'+
'[results]<tr><td>{reason}</td><td class="shouzhi" data-shouzhi="{transType}">{transAmount}</td>'+
'<td>{user_balance}</td><td class="submit-time">{time}</td><td>{remark}</td><td>预约</td>'+
'<td><a onclick="changeState(this,{id})">修改状态</a></td></tr>[/results]'+
'</tbody></table>';
var url = "/restapi/translist/" + "?page={page}&pageSize={pageSize}&user_mobile={{user.mobile}}";
//function emptydisplay(obj){
//	pic_url = "/restapi/projects/";
//	obj.html('<div class="Defa-in"><img src="' + pic_url + '">'+
//			'<h2>咦~~ 您还没有相关记录~~</h2></div>');
//}
function pagecallback(){
    $('.shouzhi').each(function(){
        console.log($(this).data('shouzhi'))
        if($(this).data('shouzhi') == '0') {
            $(this).text('+' + $(this).text());
        } else if($(this).data('shouzhi') == '1') {
            $(this).text('-' + $(this).text());
        }
    })
    $('.submit-time').each(function(){
        var submit_time = $(this).text().split('T');
        $(this).text(submit_time[0]);
    })
}

var project_id;
var parent_dom;
function changeState (obj,id) {
    parent_dom = $(obj).parent().parent();
    project_id = id;
    console.log(project_id);
    $('.popup.m-yuyue-proj').addClass('in');
}

$(function(){
	$('.back-a11').toggleClass("on");
    $(".Close").click(function(){
    	$(".Listpop").css("display","none")<!--隐藏-->
    });
	$("#pagedata").ajaxPage({
	    url:url,
	    pageId:$("#page"),
	    run:true,
	    content:data,
	    complete:pagecallback,
	});
	
	$(".RightCont").on("focus", ".date_picker", function() {
        $(this).date_input();
    })
	
	$("#search").click(function() {
        var trans_date_0 = $("#trans_date_0").val(),
            trans_date_1 = $("#trans_date_1").val(),
            transType = $("#transType").val();
        var newurl = url;
        if(trans_date_0) {
            newurl += "&trans_date_0=" + trans_date_0;
        }
        if(trans_date_1) {
            newurl += "&trans_date_1=" + trans_date_1;
        }
        if(transType) {
            newurl += "&transType=" + transType;
        }
    
        console.log(newurl);
        $("#page").empty();
        $("#pagedata").ajaxPage({
            url: newurl,
            pageId: $("#page"),
            run: true,
            content: data,
            complete:pagecallback,
        });
    });

    // 审核拒绝原因弹窗
//	$('.Content').on('click','.state_2',function(){
//		  var reason = $(this).attr('reason');
//	      alert(reason);
//	  });
});
</script>
</head>

<body>
    {% include "header.html" %}
	<div class="Content">
    	<!--头部-->
    	<!--内容-->
    	{% include "account/left.html" %}
    	<div class="RightCont">
        	<div class="fubi-box">
            	<span class="fubi-item">预约提示</span>
            	<input type="" name="" id="" value="" />
                <a class="tixian btn m-yellow r">修改</a>
            </div>
            <div class="table">
                <h2 class="table__title">预约详情</h2>
                <!--<div class="search">
                    <div class="search__item">
                        <span class="search__name">获取时间：</span>
                        <div class="time-input-box"><input type="text" class="date_picker time-input" id="trans_date_0" onchange="$('#search').click()" /></div> ——
                        <div class="time-input-box"><input type="text" class="date_picker time-input" id="trans_date_1" onchange="$('#search').click()" /></div>
                    </div>
                    <div class="search__item">
                        <span class="search__name">收支类型：</span>
                        <select name="select_status" id="transType" onchange="$('#search').click()">
                            <option value="">全部</option>
                            <option value="0">收入</option>
                            <option value="1">支出</option>
                        </select>
                    </div>
                </div>-->
                <!--<div style="display: none;" class="handle clearfix">
                    <div class="handle__out r">
                        <a id="search" class="btn m-green m-search">搜索</a>
                    </div>
                </div>-->
                <div id="pagedata">

                </div>

                <div class="changes-p">
                    <div class="page" id="page">
                    </div>
                </div>

            </div>
            
            <div class="popup m-yuyue-proj">
                <div class="popup__content" style="width: 600px;">
                    <div class="popup__top">
                        <h2 class="popup__title">修改预约状态</h2><button type="button" class="popup__close popup__close-btn" onclick="canclePopup(this)">×</button>
                    </div>
                    <div class="popup__detail">
                        <div class="popup__item">
                            <span class="popup__itemname">项目名称</span>
                            <select class="project_02" placeholder="选择项目">
                                <option value="0">预约中</option>
                                <option value="1">已接受</option>
                                <option value="2">已拒绝</option>
                            </select>
                        </div>
                    </div>
                    <div class="popup__btnbox">
                        <a class="cancel btn m-green m-right" onclick="canclePopup(this)">取消</a>
                        <a id="confirm_delete" class="btn m-green popup__close-btn">确认</a>
                    </div>
                </div>
            </div>
        </div>
    	<!--底部-->
  <div style="clear: both;"></div>
  </div>
  {% include "footer.html" %}
  <!--浮动窗口-->
    </div>
</body>
</html>
