{% load staticfiles %}
<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>注册</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="{% static 'css/mui.min.css' %}" rel="stylesheet" />
	<script type="text/javascript" src="{% static 'js/rem.js' %}"></script>
	<style type="text/css">
		body {
			background: white;
		}

		* {
			margin: 0;
			padding: 0;
			font-family: "微软雅黑";
			font-size: 15px;
		}

		table {
			margin-left: 1.5rem;
			color: RGB(102, 102, 102);
		}

		td {
			padding: 0.5rem 1rem;
		}

		.ipt {
			margin-bottom: 0 !important;
			width: 25rem !important;
			height: 3rem !important;
			border-radius: 5px !important;
			font-size: 14px;
		}

		.checkbox {
			width: 1.2rem;
			height: 1.2rem;
		}

		.numbox {
			width: 25rem;
			height: 3rem;
			border: 1px solid RGB(204, 204, 204);
			border-radius: 3px;
			position: relative;
		}

		.numbox input[type=text] {
			border: none;
			height: 2.8rem;
			font-size: 15px;
		}

		.checkbox {
			width: 1.2rem;
			height: 1.2rem;
		}

		.btn {
			background: RGB(145, 193, 29) !important;
			width: 14rem;
			height: 3rem;
			border-radius: 5px;
			text-align: center;
			line-height: 3rem;
			color: white !important;
			border: none !important;
			margin: 1.5rem 5rem;
		}
		/* checkbox */
		label {
            font-size: 12px;
            cursor: pointer;
        }

        label i {
            font-size: 14px;
            font-style: normal;
            display: inline-block;
            width: 1.2rem;
            height: 1.2rem;
            text-align: center;
            line-height: 1.2rem;
            color: #fff;
            vertical-align: middle;
            margin: -2px 2px 1px 0px;
            border: #92c11d 1px solid;
        }

        input[type="checkbox"] {
            display: none;
        }

        input[type="checkbox"]:checked+i{
            background: #92c11d;
        }
		/*样式覆盖*/

		.mui-table-view-cell.mui-active {
			background-color: transparent;
		}

		.mui-table-view:before,
		.mui-table-view:after {
			display: none;
		}

		.mui-table-view-cell {
			padding: 0;
		}

		.mui-table-view-cell>a:not(.mui-btn) {
			margin: 0;
		}

		.mui-table-view-cell.mui-collapse .mui-collapse-content {
			margin: 0;
			padding: 0;
		}
	</style>
</head>

<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #656565;"></a>
		<h1 class="mui-title">申请成为渠道</h1>
	</header>
	<div class="mui-content" style="background: white;">
		<form>
			<table>
				<!-- <tr>
					<td>手机号</td>
				</tr>
				<tr>
					<td>
						<input type="text" id="phone" name="phone" class="ipt" />
					</td>
				</tr>

				<tr>
					<td>验证码</td>
				</tr>
				<tr>
					<td>
						<div class="numbox">
							<input type="text" id="checkNum" name="checkNum" />
							<input type="button" id="setBtn" onclick="sendCode(this)" value="获取验证码" style="height:100%;position: absolute;right: 0;top: 0;background: RGB(145,193,29);color: white;"
							/>
						</div>
					</td>
				</tr> -->

				<tr>
					<td>密码</td>
				</tr>
				<tr>
					<td>
						<input type="password" id="pwd" name="password" class="mui-input-password ipt">
					</td>
				</tr>
				<tr>
					<td>QQ</td>
				</tr>
				<tr>
					<td>
						<input type="text" id="qq" name="qq" class="ipt" />
					</td>
				</tr>
				<tr>
					<td>QQ昵称</td>
				</tr>
				<tr>
					<td>
						<input type="text" id="qqName" name="qqName" class="ipt" id="qqTest" />
					</td>
				</tr>
				<tr>
					<td>邀请码（选填）</td>
				</tr>
				<tr>
					<td>
						<input type="text"  value="{{icode}}" name="invite_code" class="invite_code" id="invite_code" />
					</td>
				</tr>
				
				<tr>
					<td>
						<label>
							<input type="checkbox" id="checkbox" checked="true">
							<i>√</i>
						</label>
						<span style="font-size: 12px;">我接受<a style="font-size: 12px;color: #666666;" href="http://51fanshu.com/docs/lMOz8">《注册协议》</a>、<a style="font-size: 12px;color: #666666;" href="http://51fanshu.com/docs/laSnD">《免责声明》</a></span>
					</td>
				</tr>
				<tr>
					<td>
						<input class="btn" id="btn" type="button" value="立即申请" />
					</td>
				</tr>
			</table>
		</form>
	</div>
	{% include "m_footer.html" %}
	<script src="{% static 'js/mui.min.js' %}"></script>
	<script type="text/javascript">
		mui.init();
		var verifymobile_url = "{% url 'verifymobile' %}"; //验证手机号是否存在url
		var verifyqq_url = "{% url 'verifyqq' %}";        //验证QQurl
		var verifyinviter_url = "{% url 'verifyinviter' %}"; // 邀请码是否存在url
		var get_code_url = "{% url 'phoneImageV' %}"; //验证码url
		var register_url = "{% url 'register' %}"; //注册url
		var index_url = "";
		var login_url = "{% url 'login' %}";
		//发送验证码
		// var countdown = 60;
		// function settime(val) {
		// 	console.log('验证码');
		// 	if (countdown == 0) {
		// 		val.removeAttribute("disabled");
		// 		val.value = "获取验证码";
		// 		countdown = 60;
		// 		return;
		// 	} else {
		// 		val.setAttribute("disabled", true);
		// 		val.value = "重新发送(" + countdown + ")";
		// 		countdown--;
		// 	}
		// 	setTimeout(function () {
		// 		settime(val)
		// 	}, 1000)
		// }



		// function sendCode(thisBtn) {
		// 	var phone = document.getElementById("phone").value;
		// 	var url = "{% url 'phoneImageV' %}";
		// 	console.log(phone);
		// 	mui.ajax(url, {
		// 		data: {
		// 			"phone": phone,
		// 			"csrfmiddlewaretoken": '{{ csrf_token }}',
		// 		},
		// 		dataType: 'json', //服务器返回json格式数据
		// 		type: 'get', //HTTP请求类型
		// 		timeout: 10000, //超时时间设置为10秒；
		// 		success: function (data) {
		// 			console.log(data)
		// 			if (data.code == "0") {
		// 				mui.alert("验证码发送成功");
		// 				settime(document.getElementById("setBtn"));
		// 			} else {
		// 				mui.alert("验证码发送失败");
		// 				console.log(data.message);
		// 			}
		// 		},
		// 		error: function (xhr, type, errorThrown) {
		// 			console.log("获取数据失败");
		// 		}
		// 	});
		// }
	
		
		//邀请码是否存在
		mui(document).on('change','.invite_code',function () { 
			var inviteCode = document.getElementById('invite_code').value;
			mui.ajax(verifyinviter_url, {
				dataType: 'json', //服务器返回json格式数据
				type: 'get', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				data:{

				},
				success: function (data) {
					console.log(data)
					if (data.code == 0) {
						console.log('邀请码存在')
					} else {
						mui.alert('邀请码不存在');
					}
				},
				error: function (xhr, type, errorThrown) {
					console.log("数据请求错误");
				}
			});
		})
		//密码正则
		mui(document).on('change','#pwd',function () { 
			var pwdValue = document.getElementById('pwd').value;
			var pwdReg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;
			if (!pwdReg.test(pwdValue)) {
				mui.alert('密码为6~16位数字、字母或下划线中的两种');
				return false;
			}
		})
		var register_url = "{% url 'register' %}";

		document.getElementById("btn").addEventListener("tap", function () {
			// var phone = document.getElementById("phone").value; //手机号
			// var checkNum = document.getElementById("checkNum").value; //验证码
			var pwd = document.getElementById("pwd").value;  //密码
			var qq = document.getElementById("qq").value; //qq号
			var qqName = document.getElementById("qqName").value; // qq昵称
			var invite_code = document.getElementById("invite_code").value; //邀请码
			// var introduce = document.getElementById("introduce").value;
			var flag = document.getElementById("checkbox");
			
			if (!qq || !qqName || !pwd) {
				mui.alert("填写不能为空");
				return;
			}
			if(!flag.checked){
				mui.alert('您未同意《注册声明》和《免责协议》')
				return false;
			}
			mui.ajax(register_url, {
				data: {
					'qq_number':qq,
					'qq_name':qqName,
					// 'code':checkNum,
					// 'mobile':phone,
					'password':pwd,
					'invite_code':invite_code
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				success: function (data) {
					console.log(data)
					if (data.code == 0) {
						mui.alert("申请成功");
						mui.openWindow({
							url: '/account/login',
							styles: {
								top: 0,
								bottom: 0
							},
							show: {
								aniShow: 'slide-in-right',
							},
							waiting: {
								autoShow: false, //自动显示等待框
								title: '正在加载...', //等待对话框上显示的提示内容
							}
						});
					} else {
						mui.alert(data.msg);
					}
				},
				error: function (xhr, type, errorThrown) {
					console.log("数据请求错误");
				}
			});
		})



	</script>
</body>

</html>