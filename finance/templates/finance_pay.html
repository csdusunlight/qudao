<!DOCTYPE html>
<html lang="zh">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" type="text/css" href="/static/css/new-common.css"/>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!--<script src="./header.js" type="text/javascript" charset="utf-8"></script>-->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <style type="text/css">
      #app {
        margin: 20px;
        padding: 0 20px;
        background-color: #fff;
      }
      .search__item {
        width: 150px;
      }
    </style>
  </head>

  <body>
    <div class="header">
      <div class="bgc-333">
        <div class="headertop color-fff clearfix">
          <p class="headertop__welcome l">欢迎来到福利联盟！客服热线：0731-85586375&nbsp;&nbsp;</p>
          <ul class="r fs-0">
    
            
            <li class="d-ib">
              <font>您好,<a class="headertop__navitem link" href="/account/">18500581509</a>
                
                <a class="link" href="/merchant/index/">招商入驻</a>
                </font>
            </li>
            <!--
                         （VIP01）
                        -->
            <li class="d-ib">
              <a class="headertop__navitem link" href="/account/logout/">退出</a>
            </li>
            
    
          </ul>
        </div>
      </div>
      <div class="headermain-box bgc-fff">
        <div class="headermain clearfix">
          <a href="/"><img src="/static/images/qudao-logo.png" alt="福利联盟logo" class="logo l"></a>
          <ul class="nav nav-layout l fs-0">
            <li class="nav__itembox d-ib">
              <a class="nav__item" href="/">首页</a>
            </li>
            <li class="nav__itembox subnav-show d-ib">
              <a class="nav__item" href="/project_all/">项目库</a>
            </li>
            <li class="nav__itembox subnav-show d-ib">
                        <a class="nav__item" href="/fanshu/">番薯</a>
                    </li>
            <li class="nav__itembox subnav-show d-ib box" style="position: relative;">
              <a class="nav__item">帮助</a>
              <ul class="toggle_box" id="toggle_box">
                <div class="toggle_box_top"></div>
                <li>
                  <a href="/user_guide/">新人指南</a>
                </li>
                <li>
                  <a href="/helpCenter/">常见问题</a>
                </li>
              </ul>
            </li>
            <li class="nav__itembox d-ib">
              <a class="nav__item" href="/cooperate/">合作共赢</a>
            </li>
            <li class="nav__itembox d-ib">
              <a class="nav__item" href="/account/">个人中心</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
    <div id="app">
      <!--<el-menu class="el-menu-demo" mode="horizontal">
        <el-menu-item index="1">处理中心</el-menu-item>
        <el-submenu index="2">
          <template slot="title">我的工作台</template>
          <el-menu-item index="2-1">选项1</el-menu-item>
          <el-menu-item index="2-2">选项2</el-menu-item>
          <el-menu-item index="2-3">选项3</el-menu-item>
        </el-submenu>
        <el-menu-item index="3">消息中心</el-menu-item>
        <el-menu-item index="4"><a href="https://www.ele.me" target="_blank">订单管理</a></el-menu-item>
      </el-menu>-->
     <div class="search__box">
      <el-row>
        <el-col :span="4">
          <span>打款状态：</span>
          <el-select class="search__item" v-model="stateValue" placeholder="请选择打款状态">
            <el-option
              v-for="item in stateOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value">
            </el-option>
          </el-select>
        </el-col>
        <el-col :span="4">
          <span>时间区域：</span>
          <el-select class="search__item" v-model="dateValue" placeholder="请选择时间跨度">
            <el-option
              v-for="item in dateOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value">
            </el-option>
          </el-select>
        </el-col>
        <el-col :span="4">
          <span>投资手机号：</span>
          <el-input
            class="search__item"
            placeholder="请输入内容"
            v-model="telValue"
            clearable>
          </el-input>
        </el-col>
        <el-col :span="4">
        </el-col>
        <el-col :span="8">
          <el-button type="primary" @click="searchData">搜索</el-button>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="12">
          <el-upload
            class="avatar-uploader"
            action="/import_investlog/"
            name="uploadName"
            :show-file-list="false"
            :on-success="handleAvatarSuccess"
            :before-upload="beforeAvatarUpload">
            <el-button size="small" type="primary">上传Exel</el-button>
            <div slot="tip" class="el-upload__tip">只能上传xls文件</div>
          </el-upload>
        </el-col>
        <el-col :span="12">
          <el-button type="success" @click="badgeSelect">一键标记</el-button>
          <el-button type="warning" @click="transferSelect">一键转账</el-button>
        </el-col>
      </el-row>
     </div>
    <div class="line"></div>
    <div class="table-box">
      <el-table
        :header-cell-style="rowStyle"
        :row-style="rowStyle"
        ref="multipleTable"
        :data="tableData.results"
        style="width: 100%"
        @selection-change="handleSelectionChange">
        <el-table-column
          type="selection"
          width="55">
        </el-table-column>
        <el-table-column
          label="项目名称"
          width="120">
          <template slot-scope="scope">${ scope.row.project_title }</template>
        </el-table-column>
        <el-table-column
          label="结算金额"
          width="120">
          <template slot-scope="scope">${ scope.row.settle_amount }</template>
        </el-table-column>
        <el-table-column
          label="投资日期"
          width="120">
          <template slot-scope="scope">${ scope.row.invest_date }</template>
        </el-table-column>
        <el-table-column
          label="支付宝账号"
          width="120">
          <template slot-scope="scope">${ scope.row.zhifubao }</template>
        </el-table-column>
        <el-table-column
          label="返现金额"
          width="120">
          <template slot-scope="scope">${ scope.row.return_amount }</template>
        </el-table-column>
        <el-table-column
          label="投资手机号"
          width="120">
          <template slot-scope="scope">${ scope.row.invest_mobile }</template>
        </el-table-column>
        <el-table-column
          label="投资姓名"
          width="120">
          <template slot-scope="scope">${ scope.row.invest_name }</template>
        </el-table-column>
        <el-table-column
          label="返现状态"
          width="120">
          <template slot-scope="scope">
            <!--<span :class="{'all' : scope.row.pay_state==1}">${ scope.row.pay_state_des }</span>-->
            <span :class="'pay-state-' + scope.row.pay_state">${ scope.row.pay_state_des }</span>
          </template>
        </el-table-column>
        <el-table-column
          label="操作"
          width="120">
          <template slot-scope="scope">
            <template v-if="scope.row.pay_state == 2 || scope.row.pay_state == 3 || scope.row.pay_state == 4">
              <el-button disabled>操作</el-button>
            </template>
            <template v-else>
              <el-popover trigger="hover" placement="top">
                <p>
                  <el-button v-if="scope.row.pay_state==1" type="success" size="mini" icon="el-icon-edit" @click="edit(scope.row)">编辑</el-button>
                  <!--<el-button type="primary" size="mini" icon="el-icon-edit"  @click="badge(scope.row)">标记</el-button>-->
                  <!--<el-button v-if="scope.row.pay_state==1" type="warning" size="mini" icon="el-icon-printer" @click="transfer(scope.row)">转帐</el-button>-->
                </p>
                <div slot="reference" class="name-wrapper">
                  <el-button>操作</el-button>
                </div>
              </el-popover>
            </template>
            <el-dialog title="填写转账金额" width="600px" :visible.sync="dialogAmountVisible">
              <el-form :model="dialogData">
                <el-form-item label="转账金额" label-width="90px">
                  <el-input v-model="dialogData.return_ammount" auto-complete="off"></el-input>
                </el-form-item>
              </el-form>
              <div slot="footer" class="dialog-footer">
                <el-button @click="dialogAmountVisible = false">取 消</el-button>
                <el-button type="primary" @click="amountComfirm">确 定</el-button>
              </div>
            </el-dialog>
            <el-dialog title="填写标记信息" width="600px" :visible.sync="dialogEditVisible">
              <el-form :model="dialogData">
                <el-form-item label="转账金额" label-width="90px">
                  <el-input v-model="dialogData.return_ammount" auto-complete="off"></el-input>
                </el-form-item>
                <el-form-item label="转账金额" label-width="90px">
                  <el-input v-model="dialogData.return_ammount" auto-complete="off"></el-input>
                </el-form-item>
                <el-form-item label="转账金额" label-width="90px">
                  <el-input v-model="dialogData.return_ammount" auto-complete="off"></el-input>
                </el-form-item>
              </el-form>
              <div slot="footer" class="dialog-footer">
                <el-button @click="dialogEditVisible = false">取 消</el-button>
                <el-button type="primary" @click="dialogEditVisible = false">确 定</el-button>
              </div>
            </el-dialog>
          </template>
        </el-table-column>
      </el-table>
      <div style="margin-top: 20px">
      </div>
    </div>  <!--table-->
    <div class="pagination">
      <el-pagination
        background
        @current-change="handleCurrentChange"
        :page-size="pageSize"
        :current-page="this.currentPage"
        layout="total, prev, pager, next, jumper"
        :total="tableData.recordCount">
      </el-pagination>
    </div>    <!--pagination-->
      <p>key值为：${key}</p>
    </div>
    <script type="text/javascript">
//    $.ajax({
//      type: "get",
//      url: "http://120.79.187.115/get_upload_token/",
//      async: true,
//      success: function(res) {
//        if(res.code == 0) {
//          console.log(res);
////          app.key = res.key;
//          console.log(app.dataData3)
//          console.log(app.dataData3)
//        } else {
//          console.log(res)
//        }
//      }
//    });
      var app = new Vue({
        delimiters: ['${', '}'],
        el: '#app',
        data: {
            tableData: {},
            pageSize: 10,
            multipleSelection: [],
            checkIdList: '',
            amountSelect:'',
            key: '123',
            dialogAmountVisible: false,
            dialogEditVisible: false,
            dialogData: {
              type: '',
              id: '',
              return_amount: ''
            },
            rowStyle: {
              'text-align': 'center'
            },
            page: 1,
            stateValue: '',
            stateOptions: [{
              value: '',
              label: '全部'
            }, {
              value: '1',
              label: '未打款'
            }, {
              value: '2',
              label: '打款中'
            }, {
              value: '3',
              label: '打款成功'
            }, {
              value: '4',
              label: '打款失败'
            }],
            dateValue: '',
            dateOptions: [{
              value: '',
              label: '全部'
            }, {
              value: '7',
              label: '7天内数据'
            }, {
              value: '30',
              label: '30天内数据'
            }],
            telValue: ''
        },
        created: function() {
          $.ajax({
              type: "get",
              url: '/restapi/investlogs/?page='+ 1 + '&pageSize=' + 10 +'&audit_state=0' ,
              async: true,
              success: function(res) {
                console.log(res);
                if(res.code == 1) {
                  console.log('created');
                  console.log(res);
                  console.log(app.tableData);
                  app.tableData = res;
                  console.log(app.tableData)
                } else {
                  console.log(res)
                }
              }
          });
        },
        methods: {
          searchData: function() {
            $.ajax({
              type: "get",
              url: '/restapi/investlogs/?page=1&pageSize=' + app.pageSize +'&audit_state=0' + app.searchKeys,
              async: true,
              success: function(res) {
                console.log(res);
                if(res.code == 0) {
                  app.tableData = res;
                } else {
                  console.log(res)
                }
              }
            });
          },
          handleSelectionChange: function(val) {
            app.checkIdList = '';
            app.amountSelect = 0;
            console.log(val);
            if (val.length) {
              for (let i = 0; i < val.length; i++) {
                app.checkIdList += val[i].id + ','
                if (val[i].return_amount) {
                	app.amountSelect += parseFloat(val[i].return_amount);
                }
              }
              app.checkIdList = app.checkIdList.slice(0,app.checkIdList.length-1);
              console.log(app.checkIdList);
            } else {
              app.checkIdList = '';
              console.log(app.checkIdList);
            }
            this.multipleSelection = val;
          },
          handleCurrentChange: function (val) {
            console.log(app.searchKeys);
            console.log(app.stateValue);
            this.currentPage = val;
            $.ajax({
              type: "get",
              url: '/restapi/investlogs/?page='+ val + '&pageSize=' + app.pageSize +'&audit_state=0' + app.searchKeys,
              async: true,
              success: function(res) {
                console.log(res);
                if(res.code == 0) {
                  app.tableData = res;
                } else {
                  console.log(res)
                }
              }
            });
          },
          edit: function(row) {
            console.log(row);
            app.dialogData.id = row.id;
            app.dialogEditVisible = true;
          },
          badgeSelect: function() {
            var that = this;
            console.log(app.checkIdList)
            console.log(app.amountSelect)
            this.$alert('请确认是否一键标记所选数据？', '温馨提示', {
              confirmButtonText: '确定',
              callback: function(action) {
                console.log(action);
                if (action == 'confirm') {
                	$.ajax({
                    type: "post",
                    url: '/check_transfer/?ids='+ app.checkIdList,
                    async: true,
                    success: function(res) {
                      console.log(res);
                      if(res.code == 0) {
                        app.tableData = res;
                      } else {
                        console.log(res)
                      }
                    }
                  });
                }
              }
            });
          },
          transferSelect: function() {
            console.log(app.checkIdList)
            console.log(app.amountSelect)
            this.$alert('请确认是否一键提现所选数据？', '温馨提示', {
              confirmButtonText: '确定',
              callback: function(action) {
                console.log(action);
                if (action == 'confirm') {
                  $.ajax({
                    type: "post",
                    url: '/check_transfer/?ids='+ app.checkIdList,
                    async: true,
                    success: function(res) {
                      console.log(res);
                      if(res.code == 0) {
                        app.tableData = res;
                      } else {
                        console.log(res)
                      }
                    }
                  });
                }
              }
            });
          },
          amountComfirm: function() {
            $.ajax({
              type: "get",
              url: '/restapi/investlogs/?page='+ val + '&pageSize=' + app.pageSize +'&audit_state=0' + app.searchKeys,
              async: true,
              success: function(res) {
                console.log(res);
                if(res.code == 0) {
                  app.tableData = res;
                } else {
                  console.log(res)
                }
              }
            });
          },
          beforeAvatarUpload (file) {
            console.log(file)
            this.$message('正在上传...')
          },
          handleAvatarSuccess: function(response, file) {
            console.log(response)
          },
          getDate: function (AddDayCount) {     
             var dd = new Date();    
             dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期    
             var y = dd.getFullYear();     
             var m = (dd.getMonth()+1)<10?"0"+(dd.getMonth()+1):(dd.getMonth()+1);//获取当前月份的日期，不足10补0    
             var d = dd.getDate()<10?"0"+dd.getDate():dd.getDate();//获取当前几号，不足10补0    
             return y+"-"+m+"-"+d;     
          }
        },
        computed: {
          searchKeys: function() {
            var auditdate_0;
            var auditdate_1;
            if (app.dateValue == 7) {
            	auditdate_0 = app.getDate(0);
              auditdate_1 = app.getDate(7);
            } else if (app.dateValue == 30){
            	auditdate_0 = app.getDate(0);
              auditdate_1 = app.getDate(30);
            } else {
              auditdate_0 = '';
              auditdate_1 = '';
            }
            return '&pay_state='+ app.stateValue + '&invest_mobile='+ app.telValue + '&auditdate_0='+ auditdate_0 + '&auditdate_1='+ auditdate_1;
          }
        }
      })
    </script>
  </body>

</html>