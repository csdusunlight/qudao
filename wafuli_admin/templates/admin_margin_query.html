{% load staticfiles %}
<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="{% static 'wafuli_admin/css/AdminCommon.css' %}" />
	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
  <style>
    .grid-content{
      padding: 25px 0;
    }
  </style>
</head>
<body>
  <div id="app">
    <el-row :gutter="20">
      <el-col :span="3">
        {% include "leftNav.html" %}
      </el-col>
      <el-col :span="21">
        <div class="container">
                <el-row :gutter="20">
                    <el-col :span="6">
                        <div class="grid-content bg-purple">
                            <el-date-picker
                                v-model="date_picker"
                                type="datetimerange"
                                format="yyyy-MM-dd" value-format="yyyy-MM-dd"
                                start-placeholder="开始日期"
                                end-placeholder="结束日期"
                                :default-time="['12:00:00']">
                            </el-date-picker>
                        </div>
                    </el-col>
                    <el-col :span="6">
                        <div class="grid-content bg-purple">
                            <el-input v-model="useript" style="margin-left: 40px;width: 80%;" placeholder="用户名"></el-input>
                        </div>
                    </el-col>
                    <el-col :span="4">
                        <div class="grid-content bg-purple">
                            <el-input v-model="user_mobile" placeholder="手机号"></el-input>
                        </div>
                    </el-col>
                    <el-col :span="4">
                        <div class="grid-content bg-purple">
                            <el-input v-model="reason" placeholder="变动原因"></el-input>
                        </div>
                    </el-col>
                    <el-col :span="4">
                        <div class="grid-content bg-purple">
                            <el-button type="primary" @click='search'>搜索</el-button>
                        </div>
                    </el-col>
                </el-row>
            
          <!-- <el-header>红包方案展示</el-header> -->
          <el-table
            :header-cell-style="rowStyle"
            :row-style="rowStyle"
            ref="multipleTable"
            :data="planTableData.results"
            style="width: 100%"
            border>
            <el-table-column
              label="用户名">
              <template slot-scope="scope">${ scope.row.username }</template>
            </el-table-column>
            <el-table-column
              label="手机号">
              <template slot-scope="scope">${ scope.row.mobile }</template>
            </el-table-column>
            <el-table-column
              label="时间">
              <template slot-scope="scope">${ (scope.row.time).slice(0,10) }</template>
            </el-table-column>
            <el-table-column
              label="初始余额">
              <template slot-scope="scope">${ scope.row.initAmount }</template>
            </el-table-column>
            <el-table-column
              label="变动值">
              <template slot-scope="scope">${ scope.row.transAmount }</template>
            </el-table-column>
            <el-table-column
              label="余额">
              <template slot-scope="scope">${ scope.row.reason }</template>
            </el-table-column>
            <el-table-column
              label="变动原因">
              <template slot-scope="scope">${ scope.row.remark }</template>
            </el-table-column>
          </el-table>
          <div class="pagination-box">
            <el-pagination
              background
              @current-change="handleCurrentChange"
              :page-size="pageSize"
              :current-page="currentPage"
              layout="total, prev, pager, next, jumper"
              :total="planTableData.recordCount">
            </el-pagination>
          </div>
        </div>
      </el-col>
    </el-row>

  </div>
	
	<script type="text/javascript">
		var app = new Vue({
      el: '#app',
      delimiters: ['${', '}'],
      data: {
        reason:'',
        user_mobile:'',  
        date_picker:'',
        useript:'',
        activeNav: '5-2',
        hongbaoPlan:[],
        ruleForm: {
          hongbao_plan: [],
          send_user: '2',
          userlist: ''
        },
        dialogPlanVisible: false,
        rowStyle: {
          'text-align': 'center'
        },
        planTableData:{},
        page: 1,
        pageSize: 10,
        currentPage: 1,
      },
      created: function() {
        // this.getAllPlan();
        this.getDataList(1,10);
      },
      methods: {
        handleCurrentChange: function (val) {
          app.currentPage = val;
          app.getDataList(app.currentPage,app.pageSize);
        },
        getDataList: function(page, pageSize) {
          var that = this;
          $.ajax({
              type: "get",
              url: '/merchant/margin_translog/?page=' + page + '&pageSize=' + pageSize,
              async: true,
              success: function(res) {
                console.log(res);
                if(res.code == 0) {
                  app.planTableData = res;
                } else {
                  that.$notify.error({
                    title: '错误',
                    message: res.detail
                  });
                }
              }
          });
        },
        search:function(){
          var that = this;
          console.log(that.date_picker)
          console.log(that.date_picker[0])
          console.log(that.date_picker[1])
          $.ajax({
            url: '/merchant/margin_translog/?page=' + that.page + '&pageSize=' + that.pageSize +'&trans_date_0='+ that.date_picker[0] +'&trans_date_1='+ that.date_picker[1] +'&user_name='+ that.useript +'&user_mobile='+ that.user_mobile +'&reason_contains='+that.reason,
            async:false,
            dataType:'json',
            data:'get',
            success:function(res){
              if(res.code == 0){
                app.planTableData = res;
              }else{
                that.$notify.error({
                  title:'错误',
                  message:res.detail
                })
              }
            },
          })
        }

      }
    })
	</script>
</body>
</html>